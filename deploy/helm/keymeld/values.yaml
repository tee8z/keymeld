# KeyMeld Helm Chart Values
# Distributed MuSig2 signing system for AWS Nitro Enclaves

replicaCount: 1

image:
  repository: ghcr.io/tee8z/keymeld
  tag: ""
  pullPolicy: IfNotPresent

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""
  automount: true

service:
  type: ClusterIP
  port: 8080

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts: []
  tls: []

resources:
  requests:
    memory: 256Mi
    cpu: 100m
  limits:
    memory: 512Mi

podSecurityContext: {}
securityContext: {}

healthCheck:
  path: /health
  port: 8080

livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 30
  periodSeconds: 30
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

persistence:
  enabled: true
  storageClass: ""
  accessMode: ReadWriteOnce
  size: 5Gi
  mountPath: /var/lib/keymeld

litestream:
  enabled: true
  image:
    repository: litestream/litestream
    tag: "0.3.13"
  s3Bucket: ""
  s3Path: "keymeld.db"
  s3Region: "us-west-2"
  s3Endpoint: ""
  s3ForcePathStyle: false
  syncInterval: "10s"
  retention: "168h"
  snapshotInterval: "1h"

enclave:
  enabled: false
  simulation: false
  image:
    repository: ghcr.io/tee8z/keymeld-enclave
    tag: ""
    pullPolicy: IfNotPresent
  resources:
    requests:
      memory: 128Mi
      cpu: 50m
    limits:
      memory: 256Mi
  logLevel: "info,keymeld_enclave=debug"
  enclaves:
    - id: 0
      cid: 3
      port: 8000
    - id: 1
      cid: 4
      port: 8000
  eifPath: /opt/keymeld/keymeld.eif
  vsockTimeoutSecs: 300
  sessionInitTimeoutSecs: 1800
  signingTimeoutSecs: 600

kms:
  enabled: false
  keyArn: ""
  region: "us-west-2"
  endpoint: ""
  mock: false

# AWS credentials (for local dev with moto)
aws:
  accessKeyId: ""
  secretAccessKey: ""

config:
  environment: production
  server:
    host: "0.0.0.0"
    port: 8080
    enableCors: false
    enableCompression: true
  database:
    maxConnections: 50
    connectionTimeoutSecs: 10
    idleTimeoutSecs: 300
    enableWalMode: true
  coordinator:
    processingIntervalMs: 100
    batchSize: 100
    maxRetries: 5
    processingTimeoutMins: 1
  logging:
    level: "info"
    format: "json"
    enableJson: true
    enableFileOutput: false
  security:
    enableAttestation: true
    strictValidation: true
    allowInsecureConnections: false
    requireTls: false
  development: null

env: {}
envFrom: []
nodeSelector: {}
tolerations: []
affinity: {}
podAnnotations: {}
podLabels: {}

metrics:
  enabled: false
  path: /metrics
  interval: 30s

# Dev mode configuration for fast local development
# Uses locally-compiled cargo binaries instead of container images
devMode:
  enabled: false
  gateway:
    # Path to the gateway binary inside the k3d node (mounted from host)
    hostPath: /mnt/keymeld/keymeld-gateway
  enclave:
    # Path to the enclave binary inside the k3d node (mounted from host)
    hostPath: /mnt/keymeld/keymeld-enclave
  # Base image for running the binaries (must have libc, ssl, etc.)
  baseImage: debian:bookworm-slim
