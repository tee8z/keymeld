Starting KeyMeld Example...
Waiting for KeyMeld Gateway at http://gateway:8080...
Gateway is ready!
Starting KeyMeld example...
2025-11-15T17:50:21.877904Z  INFO keymeld_example: Loaded configuration
2025-11-15T17:50:21.878426Z  INFO keymeld_example: Setting up Bitcoin Core wallet for funding...
2025-11-15T17:50:21.878444Z  INFO keymeld_example: âœ… Connected to Bitcoin Core keymeld_coordinator wallet
2025-11-15T17:50:21.878955Z  INFO keymeld_example: âœ… Bitcoin Core keymeld_coordinator wallet balance: 5100 BTC BTC
2025-11-15T17:50:21.878985Z  INFO keymeld_example: Loading coordinator private key from: /app/keys/coordinator_master.key
2025-11-15T17:50:21.879003Z  INFO keymeld_example: Found extended private key (xprv) format from Bitcoin Core
2025-11-15T17:50:21.885824Z  INFO keymeld_example: âœ… Using extended private key from Bitcoin Core with BIP86 derivation
2025-11-15T17:50:21.886028Z  INFO keymeld_example: ğŸ”‘ Persistent Coordinator Address: bcrt1pm6px2pz37ep4jmxzmkqky4xuedka2qca8zae32gy4xzm4f82cn9qwmdj4q
2025-11-15T17:50:21.886035Z  INFO keymeld_example: ğŸ’° To fund coordinator manually: bitcoin-cli -regtest -rpcuser=keymeld -rpcpassword=keymeldpass123 generatetoaddress 101 bcrt1pm6px2pz37ep4jmxzmkqky4xuedka2qca8zae32gy4xzm4f82cn9qwmdj4q
2025-11-15T17:50:21.935094Z  INFO keymeld_example: ğŸ§ª KeyMeld End-to-End Test - Two-Phase Flow
2025-11-15T17:50:21.935106Z  INFO keymeld_example: ============================================
2025-11-15T17:50:21.935108Z  INFO keymeld_example: Network: regtest
2025-11-15T17:50:21.935110Z  INFO keymeld_example: Gateway: http://gateway:8080
2025-11-15T17:50:21.935112Z  INFO keymeld_example: Participants: 2
2025-11-15T17:50:21.935114Z  INFO keymeld_example: Creating 2 participant wallets...
2025-11-15T17:50:21.943106Z  INFO keymeld_example: Created participant (019a88a3-b6ef-7cb1-8a80-2dccfafcf52e): 03145a965bf9262233cf0854e0f505120cd51ecfdd448aba84b7bb240ed10b5882 (145a965b) - Address: bcrt1paxqjjregp9l5pkv2047sgvny4h6prjncg5hsyktgg3jkseenszmq8ep8um
2025-11-15T17:50:21.950937Z  INFO keymeld_example: Created participant (019a88a3-b6f7-7970-a2c8-01d284224335): 0254810c3e9b509ea393222164c4b66e10e15f5701751b8afb008dbb6a63f17ced (54810c3e) - Address: bcrt1p4d2h2akpqme87fv7uukrcx5zm800mf4vc4zmnycrq9hpr9q7fkfsqgy6py
2025-11-15T17:50:21.950951Z  INFO keymeld_example: ğŸ“¤ Step 1: Funding coordinator's derived address from master wallet...
2025-11-15T17:50:21.951094Z  INFO keymeld_example: ğŸ”‘ Coordinator derived address: bcrt1pm6px2pz37ep4jmxzmkqky4xuedka2qca8zae32gy4xzm4f82cn9qwmdj4q
2025-11-15T17:50:21.951103Z  INFO keymeld_example: ğŸ’° Sending 0.00065 BTC from master wallet to coordinator: bcrt1pm6px2pz37ep4jmxzmkqky4xuedka2qca8zae32gy4xzm4f82cn9qwmdj4q
2025-11-15T17:50:21.991008Z  INFO keymeld_example: âœ… Funding transaction sent: 3feb47ad9790ecf42ae64a79651e531adc6de7b15d78ba888b8c7c93ef4ef8f3
2025-11-15T17:50:22.042681Z  INFO keymeld_example: â›ï¸ Mined 6 blocks to confirm funding
2025-11-15T17:50:22.042700Z  INFO keymeld_example: ğŸ”„ Refreshing coordinator wallet state...
2025-11-15T17:50:22.052182Z  INFO keymeld_example: âœ… Wallet state refreshed! Balance: 0.00065000 BTC sats
2025-11-15T17:50:22.052194Z  INFO keymeld_example:    - Confirmed: 0 BTC sats
2025-11-15T17:50:22.052197Z  INFO keymeld_example:    - Trusted pending: 0 BTC sats
2025-11-15T17:50:22.052199Z  INFO keymeld_example:    - Untrusted pending: 0.00065000 BTC sats
2025-11-15T17:50:22.052202Z  INFO keymeld_example:    - Immature: 0 BTC sats
2025-11-15T17:50:22.052205Z  INFO keymeld_example: ğŸ”‘ Starting Phase 1: Keygen Session
2025-11-15T17:50:22.052236Z  INFO keymeld_example: ğŸ”‘ Creating KeyMeld keygen session...
2025-11-15T17:50:22.053666Z  INFO keymeld_example: Selected enclave enclave-0 with key epoch 1
2025-11-15T17:50:22.056811Z  INFO keymeld_example: ğŸ” Simulating out-of-band session secret sharing...
2025-11-15T17:50:22.056828Z  INFO keymeld_example:    ğŸ“‹ Session ID: 019a88a3-b765-70f3-8e8d-43075be1328d
2025-11-15T17:50:22.056832Z  INFO keymeld_example:    ğŸ”‘ Session Secret (first 10 chars): 3548702105...
2025-11-15T17:50:22.056836Z  INFO keymeld_example:    âš ï¸  In production, coordinator would securely share this secret with participants
2025-11-15T17:50:22.056840Z  INFO keymeld_example:       through encrypted channels (Signal, PGP, secure email, in-person, etc.)
2025-11-15T17:50:22.056842Z  INFO keymeld_example:    âš ï¸  This secret enables participants to prove authorization for keygen participation
2025-11-15T17:50:22.056849Z  INFO keymeld_example:    ğŸ“¤ [OUT-OF-BAND] Coordinator securely shares session secret with participant 1 (145a965b)
2025-11-15T17:50:22.056852Z  INFO keymeld_example:       ğŸ“± Participant 1 receives and stores session secret securely
2025-11-15T17:50:22.056855Z  INFO keymeld_example:    ğŸ“¤ [OUT-OF-BAND] Coordinator securely shares session secret with participant 2 (54810c3e)
2025-11-15T17:50:22.056857Z  INFO keymeld_example:       ğŸ“± Participant 2 receives and stores session secret securely
2025-11-15T17:50:22.056860Z  INFO keymeld_example: âœ… Out-of-band session secret sharing simulation completed
2025-11-15T17:50:22.056862Z  INFO keymeld_example:    ğŸ”’ All participants now have the shared secret for HMAC generation
2025-11-15T17:50:22.056865Z  INFO keymeld_example: âœ… Keygen session 019a88a3-b765-70f3-8e8d-43075be1328d created
2025-11-15T17:50:22.056869Z  INFO keymeld_example: ğŸ“‹ Approval Configuration:
2025-11-15T17:50:22.056872Z  INFO keymeld_example:    - Coordinator requires signing approval: YES
2025-11-15T17:50:22.056874Z  INFO keymeld_example:    - Participant 0 requires signing approval: YES
2025-11-15T17:50:22.056877Z  INFO keymeld_example:    - Other participants require signing approval: NO
2025-11-15T17:50:22.056879Z  INFO keymeld_example: ğŸ‘¥ Registering participants for keygen session...
2025-11-15T17:50:22.057663Z  INFO keymeld_example: Keygen session 019a88a3-b765-70f3-8e8d-43075be1328d has 3 available slots
2025-11-15T17:50:22.057674Z  INFO keymeld_example: ğŸ“ Registering coordinator...
2025-11-15T17:50:22.060940Z  INFO keymeld_example: âœ… Coordinator registered for keygen
2025-11-15T17:50:22.060959Z  INFO keymeld_example: ğŸ“ Registering participant 0...
2025-11-15T17:50:22.063980Z  INFO keymeld_example: âœ… Participant 0 registered for keygen: {"keygen_session_id":"019a88a3-b765-70f3-8e8d-43075be1328d","user_id":"019a88a3-b765-70f3-8e8d-4325010c2e16","status":"collecting_participants","participants_registered":2,"expected_participants":3,"signer_index":1,"assigned_enclave_id":1,"require_signing_approval":true}
2025-11-15T17:50:22.063994Z  INFO keymeld_example: ğŸ“ Registering participant 1...
2025-11-15T17:50:22.066770Z  INFO keymeld_example: âœ… Participant 1 registered for keygen: {"keygen_session_id":"019a88a3-b765-70f3-8e8d-43075be1328d","user_id":"019a88a3-b765-70f3-8e8d-43340d57ce04","status":"collecting_participants","participants_registered":3,"expected_participants":3,"signer_index":2,"assigned_enclave_id":2,"require_signing_approval":false}
2025-11-15T17:50:22.066784Z  INFO keymeld_example: âœ… All 3 participants registered for keygen
2025-11-15T17:50:23.068326Z  INFO keymeld_example: ğŸ” Verifying all participants are properly registered...
2025-11-15T17:50:23.071365Z  INFO keymeld_example: ğŸ“Š Keygen session status: Completed
2025-11-15T17:50:23.071377Z  INFO keymeld_example: ğŸ“Š Registered participants: 3
2025-11-15T17:50:23.071380Z  INFO keymeld_example: ğŸ“Š Expected participants: 3
2025-11-15T17:50:23.071383Z  INFO keymeld_example: âœ… All 3 participants properly registered
2025-11-15T17:50:23.071386Z  INFO keymeld_example: â³ Waiting for keygen completion...
2025-11-15T17:50:23.073213Z  INFO keymeld_example: â³ Keygen attempt 1/60 - Status: Completed, Registered: 3/3
2025-11-15T17:50:23.073240Z  INFO keymeld_example: ğŸ‰ Keygen completed successfully after 1 attempts
2025-11-15T17:50:23.073244Z  INFO keymeld_example: âœ… Keygen complete: 02ba372db0f0146353b9ca9780816a562b67d8f90a0705e222816193d1338b5ca7
2025-11-15T17:50:23.073248Z  INFO keymeld_example: ğŸ’° Step 2A: Funding aggregate key address (consolidation transaction)...
2025-11-15T17:50:23.073262Z  INFO keymeld_example: ğŸ¦ Aggregate key taproot address: bcrt1phgmjmv8sz3348ww2j7qgz6jk9dna37g2quz7yg5pvxfazvuttjns72gscd
2025-11-15T17:50:23.077205Z  INFO keymeld_example: âœ… Consolidation transaction sent: 6c37aaf25aebb5a260099e46e187ea299c78b5d4e6ca8787f5ce295dddd73436
2025-11-15T17:50:23.081168Z  INFO keymeld_example: â›ï¸ Mined 6 blocks to confirm consolidation
2025-11-15T17:50:23.081288Z  INFO keymeld_example: ğŸ“ Step 2B: Creating transaction spending from aggregate key...
2025-11-15T17:50:23.081306Z  INFO keymeld_example: Creating MuSig2 transaction: 5000 sats to bcrt1qf0p0zqynlcq7c4j6vm53qaxapm3chufwfgge80
2025-11-15T17:50:23.081318Z  INFO keymeld_example: Spending UTXO: 6c37aaf25aebb5a260099e46e187ea299c78b5d4e6ca8787f5ce295dddd73436:1 (15000 sats)
2025-11-15T17:50:23.081348Z  INFO keymeld_example: âœ… Using KeyMeld's pre-tweaked MuSig2 aggregate key for Bitcoin compatibility
2025-11-15T17:50:23.081363Z  INFO keymeld_example: âœ… Created MuSig2 transaction with 1 inputs and 2 outputs
2025-11-15T17:50:23.081371Z  INFO keymeld_example: ğŸ” This transaction will be signed using KeyMeld MuSig2
2025-11-15T17:50:23.081380Z  INFO keymeld_example: âœï¸ Starting Phase 2: Signing Session
2025-11-15T17:50:23.081388Z  INFO keymeld_example: âœï¸ Creating signing session...
2025-11-15T17:50:23.084999Z  INFO keymeld_example: âœ… Signing session 019a88a3-bb69-7112-8dd0-0a63d0e55bd2 created
2025-11-15T17:50:23.085021Z  INFO keymeld_example: ğŸ“‹ Starting Phase 2a: Signing Approvals
2025-11-15T17:50:23.085024Z  INFO keymeld_example: âš ï¸  Participants requiring approval before signing can proceed:
2025-11-15T17:50:23.085027Z  INFO keymeld_example:    - Coordinator: 019a88a3-b765-70f3-8e8d-4311ecac8aa3
2025-11-15T17:50:23.085031Z  INFO keymeld_example:    - Participant 0: 019a88a3-b765-70f3-8e8d-4325010c2e16
2025-11-15T17:50:23.085035Z  INFO keymeld_example: âœ… Approving signing session 019a88a3-bb69-7112-8dd0-0a63d0e55bd2 for user 019a88a3-b765-70f3-8e8d-4311ecac8aa3
2025-11-15T17:50:23.087008Z  INFO keymeld_example: âœ… Signing session 019a88a3-bb69-7112-8dd0-0a63d0e55bd2 approved by user 019a88a3-b765-70f3-8e8d-4311ecac8aa3
2025-11-15T17:50:23.087022Z  INFO keymeld_example: âœ… Approving signing session 019a88a3-bb69-7112-8dd0-0a63d0e55bd2 for user 019a88a3-b765-70f3-8e8d-4325010c2e16
2025-11-15T17:50:23.088259Z  INFO keymeld_example: âœ… Signing session 019a88a3-bb69-7112-8dd0-0a63d0e55bd2 approved by user 019a88a3-b765-70f3-8e8d-4325010c2e16
2025-11-15T17:50:23.088272Z  INFO keymeld_example: âœ… All required approvals completed - signing can now proceed
2025-11-15T17:50:23.088274Z  INFO keymeld_example: â³ Waiting for signing completion...
2025-11-15T17:50:23.089112Z  INFO keymeld_example: Signing still collecting participants...
2025-11-15T17:50:25.092112Z  INFO keymeld_example: Generating nonces...
2025-11-15T17:50:27.096128Z  INFO keymeld_example: Aggregating nonces...
2025-11-15T17:50:29.099743Z  INFO keymeld_example: Collecting partial signatures...
2025-11-15T17:50:31.103805Z  INFO keymeld_example: ğŸ” Applying MuSig2 signature to transaction...
2025-11-15T17:50:31.103833Z  INFO keymeld_example: ğŸ“¡ Broadcasting transaction: 629fae2dfda9ec8f4a626ab65167bf15e68264e1fbfbb185a8238b53156a1660
2025-11-15T17:50:31.149980Z  INFO keymeld_example: âœ… Transaction broadcast successfully: 629fae2dfda9ec8f4a626ab65167bf15e68264e1fbfbb185a8238b53156a1660

ğŸ‰ Three-Phase KeyMeld Test Completed Successfully!
âœ… Phase 1: Keygen session completed
âœ… Phase 2a: Signing approvals completed (with HMAC authentication)
âœ… Phase 2b: Signing session completed (participants inherited from keygen)
âœ… Aggregate key: 02ba372db0f0146353b9ca9780816a562b67d8f90a0705e222816193d1338b5ca7
âœ… Transaction broadcast: 629fae2dfda9ec8f4a626ab65167bf15e68264e1fbfbb185a8238b53156a1660
ğŸ“‹ Keygen Session ID: 019a88a3-b765-70f3-8e8d-43075be1328d
ğŸ“‹ Signing Session ID: 019a88a3-bb69-7112-8dd0-0a63d0e55bd2

âœ… KeyMeld end-to-end test completed successfully!
